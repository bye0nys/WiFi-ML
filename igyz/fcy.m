clear all;

X = [1;1;1;1];
Y = [1;1;1;1];
Z = [1;1;1;1];
r = [1;1;1;1];

a = [1;2;3];

repeat = 1000;

for n = 1 : repeat
    F1 = sqrt((X(1) - a(1)).^2 + (X(2)-b(1)).^2 + (X(3) - c(1)).^2) - r(1);
    F2 = sqrt((X(1) - a(2)).^2 + (X(2)-b(2)).^2 + (X(3) - c(2)).^2) - r(2);
    F3 = sqrt((X(1) - a(3)).^2 + (X(2)-b(3)).^2 + (X(3) - c(3)).^2) - r(3);
    F4 = sqrt((X(1) - a(4)).^2 + (X(2)-b(4)).^2 + (X(3) - c(4)).^2) - r(4);
    F5 = sqrt((X(1) - a(1)).^2 + (X(2) - b(1)).^2 + (X(3) - c(1).^2)) + sqrt((X(1) - a(2)).^2 + (X(2) - b(2)).^2 + (X(3) - c(2).^2)) -r(1) - r(2);
    F6 = sqrt((X(1) - a(1)).^2 + (X(2) - b(1)).^2 + (X(3) - c(1).^2)) + sqrt((X(1) - a(4)).^2 + (X(2) - b(4)).^2 + (X(3) - c(4).^2)) -r(1) - r(4);
    F7 = sqrt((X(1) - a(3)).^2 + (X(2) - b(3)).^2 + (X(3) - c(3).^2)) + sqrt((X(1) - a(4)).^2 + (X(2) - b(4)).^2 + (X(3) - c(4).^2)) -r(3) - r(4);
    F8 = sqrt((X(1) - a(3)).^2 + (X(2) - b(3)).^2 + (X(3) - c(3).^2)) + sqrt((X(1) - a(2)).^2 + (X(2) - b(2)).^2 + (X(3) - c(2).^2)) -r(2) - r(3);
    F9 = sqrt((X(1) - a(1)).^2 + (X(2) - b(1)).^2 + (X(3) - c(1).^2)) + sqrt((X(1) - a(3)).^2 + (X(2) - b(3)).^2 + (X(3) - c(3).^2)) -r(1) - r(3);
    F10 = sqrt((X(1) - a(2)).^2 + (X(2) - b(2)).^2 + (X(3) - c(2).^2)) + sqrt((X(1) - a(4)).^2 + (X(2) - b(4)).^2 + (X(3) - c(4).^2)) -r(2) - r(4);
       
  
    F = [F1;F2;F3;F4;F5;F6;F7;F8;F9;F10];
    
    Qx = [((X(1)-a(1))./sqrt((X(1)-a(1)).^2 + (X(2)-b(1)).^2 + (X(3) -c(1)).^2)),((X(1)-a(2))./sqrt((X(1)-a(2)).^2 + (X(2)-b(2)).^2 + (X(3) -c(2)).^2)),((X(1)-a(3))./sqrt((X(1)-a(3)).^2 + (X(2)-b(3)).^2 + (X(3) -c(3)).^2)),((X(1)-a(4))./sqrt((X(1)-a(4)).^2 + (X(2)-b(4)).^2 + (X(3) -c(4)).^2))];
    Qy = [((X(2)-b(1))./sqrt((X(1)-a(1)).^2 + (X(2)-b(1)).^2 + (X(3) -c(1)).^2)),((X(2)-b(2))./sqrt((X(1)-a(2)).^2 + (X(2)-b(2)).^2 + (X(3) -c(2)).^2)),((X(2)-b(3))./sqrt((X(1)-a(3)).^2 + (X(2)-b(3)).^2 + (X(3) -c(3)).^2)),((X(2)-b(4))./sqrt((X(1)-a(4)).^2 + (X(2)-b(4)).^2 + (X(3) -c(4)).^2))];
    Qz = [((X(3)-c(1))./sqrt((X(1)-a(1)).^2 + (X(2)-b(1)).^2 + (X(3) -c(1)).^2)),((X(3)-c(2))./sqrt((X(1)-a(2)).^2 + (X(2)-b(2)).^2 + (X(3) -c(2)).^2)),((X(3)-c(3))./sqrt((X(1)-a(3)).^2 + (X(2)-b(3)).^2 + (X(3) -c(3)).^2)),((X(3)-c(4))./sqrt((X(1)-a(4)).^2 + (X(2)-b(4)).^2 + (X(3) -c(4)).^2))];
          

    J1 = [(X(1)-a(1))./sqrt((X(1)-a(1)).^2 + (X(2)-b(1)).^2 + (X(3) - c(1)).^2),(X(2)-b(1))./sqrt((X(1)-a(1)).^2 + (X(2)-b(1)).^2+ (X(3) - c(1)).^2),(X(3)-c(1))./sqrt((X(1)-a(1)).^2 + (X(2)-b(1)).^2+ (X(3) - c(1)).^2)];
    J2 = [(X(1)-a(2))./sqrt((X(1)-a(2)).^2 + (X(2)-b(2)).^2 + (X(3) - c(2)).^2),(X(2)-b(2))./sqrt((X(1)-a(2)).^2 + (X(2)-b(2)).^2 + (X(3) - c(2)).^2),(X(3)-c(2))./sqrt((X(1)-a(2)).^2 + (X(2)-b(2)).^2 + (X(3) - c(2)).^2)];
    J3 = [(X(1)-a(3))./sqrt((X(1)-a(3)).^2 + (X(2)-b(3)).^2 + (X(3) - c(3)).^2),(X(2)-b(3))./sqrt((X(1)-a(3)).^2 + (X(2)-b(3)).^2 + (X(3) - c(3)).^2),(X(3)-c(3))./sqrt((X(1)-a(3)).^2 + (X(2)-b(3)).^2 + (X(3) - c(3)).^2)];
    J4 = [(X(1)-a(4))./sqrt((X(1)-a(4)).^2 + (X(2)-b(4)).^2 + (X(3) - c(4)).^2),(X(2)-b(4))./sqrt((X(1)-a(4)).^2 + (X(2)-b(4)).^2 + (X(3) - c(4)).^2),(X(3)-c(4))./sqrt((X(1)-a(4)).^2 + (X(2)-b(4)).^2 + (X(3) - c(4)).^2)];
    J5 = [Qx(1)+ Qx(2), Qy(1) + Qy(2) , Qz(1) + Qz(2)];
    J6 = [Qx(1) + Qx(4) , Qy(1) + Qy(4) , Qz(1) + Qz(4)];
    J7 = [Qx(3) + Qx(4) , Qy(3) + Qy(4) , Qz(3) + Qz(4)];
    J8 = [Qx(3) + Qx(2) , Qy(3) + Qy(2) ,  Qz(3) + Qz(2)];
    J9 = [Qx(1) + Qx(3) , Qy(1) + Qy(3) , Qz(1) + Qz(3)];
    J10 = [Qx(2) + Qx(4) , Qy(2) + Qy(4) , Qz(2) + Qz(4)];
    J = [J1;J2;J3;J4;J5;J6;J7;J8;J9;J10];
  
    F1_set(n) = abs(F(1));
    F2_set(n) = abs(F(2));
    F3_set(n) = abs(F(3));
    F4_set(n) = abs(F(4));
    F5_set(n) = abs(F(5));
    F6_set(n) = abs(F(6));
    F7_set(n) = abs(F(7));
    F8_set(n) = abs(F(8));
    F9_set(n) = abs(F(9));
    F10_set(n) = abs(F(10));
    F1_Set(n) = F(1);
    F2_Set(n) = F(2);
    F3_Set(n) = F(3);
    F4_Set(n) = F(4);
    F5_Set(n) = F(5);
    F6_Set(n) = F(6);
    F7_Set(n) = F(7);
    F8_Set(n) = F(8);
    F9_Set(n) = F(9);
    F10_Set(n) = F(10);
    
     
    X1_set(n) = X(1);
    X2_set(n) = X(2);
    X3_set(n) = X(3);
    
    F_set = [F1_set ; F2_set ; F3_set ; F4_set; F5_set; F6_set; F7_set; F8_set; F9_set; F10_set];
    F_Realset = [F1_Set ; F2_Set ; F3_Set ; F4_Set; F5_Set; F6_Set; F7_Set; F8_Set; F9_Set; F4_Set];
    X_set = [X1_set ; X2_set ; X3_set];
        
    GG = (J' * J)\ J' * F;
    X = X - GG;
end
F_sum = sum(F_set);
F_summin = min(F_sum);

for k = 1 : repeat
    if F_sum(k) == F_summin
        X_set(:, k)
        F_Realset(:, k)
        break;
    end
end